# 当前项目架构+功能清单分析报告

## 1. 项目概况
- **项目名称**: 水产品微信小程序SaaS平台 (water-mall)
- **部署路径**: `/srv/client-web/www/shui.13982.com/`
- **技术栈**: 
    - **框架**: ThinkPHP 6.0
    - **语言**: PHP
    - **数据库**: MySQL
    - **Web服务器**: Nginx
- **架构模式**: MVC (Model-View-Controller)

## 2. 数据库设计分析
通过对 `schema.sql` 和 `config/database.php` 的分析：
- **数据库名**: `shui_13982_com`
- **主要表结构**:
    - `wyu_shop`: 商户表
    - `wyu_water_order`: 核心订单表
    - `wyu_water_member`: 会员表
    - `wyu_water_mall_product`: 商品表
    - `wyu_water_ticket`: 水票表

## 3. 功能清单梳理

### 3.1 总后台管理端 (Platform Admin)
**访问地址**: `https://shui.13982.com/admin/`
**代码对应**: `app/platform/controller/admin`

- **首页 (Home)**: 数据概览。
- **用户管理 (Account)**: 平台管理员、权限管理。
- **商户管理 (Shop)**:
    - 商户列表与状态管理 (开启/关闭/审核)。
    - 商户入驻流程。
- **应用中心 (Application)**: 插件/SaaS模块管理。
- **系统设置 (Setting)**: 平台全局参数。

### 3.2 商户后台管理端 (Merchant Platform)
**入口**: 总后台 -> 商户列表 -> 进入管理
**代码对应**: `app/water/controller/admin`

- **首页 (Home)**: 数据概览。
- **设置 (Settings)**
    - **门店管理**: 门店列表与详情。
    - **系统配置**: 基础设置。
    - **账号管理**: 商户子账号权限管理。
    - **短信/积分设置**: 营销规则配置。
- **会员 (Member)**
    - **会员管理**: 列表、导入导出 (Import/Export)。
    - **等级/积分/余额**: 资金变动记录。
    - **会员押金**: 桶/饮水机押金管理。
- **优惠券 (Coupon)**
    - **管理**: 上架中/下架过期。
    - **记录**: 发放与使用日志。
- **订水商城 (Water Mall)**
    - **水票管理**: 发行、管理、日志。
    - **商品管理**: 
        - 仅记录销量 (`sold_num`)，**无库存 (`stock`) 字段**，默认为无限库存模式。
        - 支持多规格 (SKU)，但仅维护价格差异。
    - **订单管理**: 
        - **状态流转**: 待支付 -> 待接单 -> 待派单 -> 配送中 -> 已完成。
        - **派单逻辑**: 
            - 列表展示：待派单订单。
            - 派单操作：选择配送员 -> 系统发送短信通知配送员 (`waterStaffJie`) 和用户 (`waterOrderUser`)。
            - 异常处理：支持取消订单 (商户/配送员)。
    - **数据统计**: 销量与GMV统计。
- **合伙人 (Partner)**
    - **股东合伙人**: 设定股金与分红比例。
    - **员工合伙人**: 设定业绩范围与提成比例。
    - **功能**: 支持绑定现有用户，查看提现记录。
- **营销 (Marketing)**
    - **优惠券**: 支持普通券、新人券、会员券、邀请券。主要为"满减"模式。
- **小程序 (Mini-Program)**
    - **装修**: 主题设置。
    - **支付**: 支付参数配置。
    - **推荐**: 推荐其他小程序。

## 4. 痛点分析
1. **库存缺失**: 现有系统无库存扣减逻辑，可能导致超卖或无法管理实体库存。
2. **性能瓶颈**: PHP同步阻塞模式在高并发派单场景下乏力。
3. **架构陈旧**: 缺乏前后端分离，维护成本高。
4. **安全性**: 现有代码可能存在 SQL 注入风险，且框架版本更新滞后。
5. **功能局限**: 派单仅支持手动或简单指派，缺乏基于位置(LBS)的智能调度。
2. **架构陈旧**: 缺乏前后端分离，维护成本高。
3. **安全性**: 现有代码可能存在 SQL 注入风险，且框架版本更新滞后。
